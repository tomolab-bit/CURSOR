# 予算データ統合手順

## 問題の説明

現在、`月次DB_SharePoint用.csv`には実績データ（Actual）のみが含まれており、予算データ（Plan）がすべて0になっています。

2025年4月の予算データ（#2 Monthly PL Budget）が見つからない原因は、**予算データが別のファイルにあるか、または2026年のデータになっている**可能性があります。

## 解決方法

### 方法1: 予算データファイルを指定する

予算データが別のCSVファイル（#3形式）にある場合：

1. **スクリプトを開く**
   - `convert_to_monthly_db_simple.py`を開く

2. **予算データファイルのパスを指定**
   ```python
   # 予算データファイル（オプション）
   budget_file = '/path/to/budget_data.csv'  # 予算データのファイルパスを指定
   ```

3. **スクリプトを実行**
   ```bash
   python3 convert_to_monthly_db_simple.py
   ```

### 方法2: 予算データを手動で追加する

予算データファイルがない場合、または特定の月の予算データを追加したい場合：

1. **現在のCSVファイルをエクセルで開く**
   - `月次DB_SharePoint用.csv`をエクセルで開く

2. **Plan行のAmount列を更新**
   - Type列が「Plan」の行をフィルタ
   - 該当するAccount Codeと年月のAmount列に予算値を入力

3. **保存**
   - エクセル形式で保存

### 方法3: 予算データファイルの構造を確認

予算データファイルが#3形式（同じ構造）の場合：

- ファイル名: `Glory　Format - #2 Budget (DB for BI report).csv` など
- 構造: 実績データと同じ#3形式
- 日付: 2025年4月のデータが含まれているか確認

## 予算データファイルの場所

予算データファイルが以下の場所にある可能性があります：

1. **同じフォルダ内**
   - `01.3consulting/`フォルダ内
   - ファイル名に「Budget」や「予算」が含まれている

2. **別のフォルダ**
   - `20_DATA_Input/`フォルダ内の他の場所
   - SharePointや他の場所

3. **エクセル形式**
   - エクセルファイル（.xlsx）の場合、CSVに変換が必要

## 確認事項

### 1. 予算データファイルの有無

予算データファイルが存在するか確認してください：

```bash
ls -la /Users/sugenotomohiro/Desktop/CURSOR/Manabox/20_DATA_Input/01.3consulting/*Budget*
ls -la /Users/sugenotomohiro/Desktop/CURSOR/Manabox/20_DATA_Input/01.3consulting/*予算*
```

### 2. 日付の確認

予算データファイルに2025年4月のデータが含まれているか確認：

- Apr-25（2025年4月）のデータがあるか
- またはApr-26（2026年4月）のデータになっていないか

### 3. Account Codeの一致

予算データのAccount Codeが実績データと一致しているか確認：

- 511（売上）のAccount Codeが存在するか
- 同じAccount Code構造になっているか

## スクリプトの使用方法

### 基本的な使い方（予算データなし）

```python
budget_file = None  # 予算データなし
```

### 予算データファイルを指定する場合

```python
budget_file = '/Users/sugenotomohiro/Desktop/CURSOR/Manabox/20_DATA_Input/01.3consulting/Glory　Format - #2 Budget.csv'
```

### 実行

```bash
cd /Users/sugenotomohiro/Desktop/CURSOR/Manabox/20_DATA_Input/01.3consulting
python3 convert_to_monthly_db_simple.py
```

## 出力結果

予算データが正しく読み込まれた場合：

```
予算データを読み込み中: budget_data.csv
予算データ読み込み完了: 372件のレコード
...
サンプルデータ（最初の5件）:
1. 2025-04 | 511 | Plan | 2,800,000,000
2. 2025-04 | 511 | Actual | 2,880,129,396
3. 2025-04 | 5113 | Plan | 2,800,000,000
4. 2025-04 | 5113 | Actual | 2,880,129,396
...
```

## トラブルシューティング

### 問題1: 予算データが見つからない

**原因**: 予算データファイルが存在しない、またはパスが間違っている

**解決方法**:
1. 予算データファイルの場所を確認
2. ファイルパスが正しいか確認
3. ファイルが#3形式（同じ構造）か確認

### 問題2: 2025年4月のデータが見つからない

**原因**: 予算データが2026年のデータになっている

**解決方法**:
1. 予算データファイルの日付を確認
2. Apr-25（2025年4月）のデータがあるか確認
3. 必要に応じて日付を修正

### 問題3: Account Codeが一致しない

**原因**: 予算データと実績データのAccount Codeが異なる

**解決方法**:
1. 両方のファイルのAccount Code構造を確認
2. マスターフォーマット#3と一致しているか確認
3. 必要に応じてAccount Codeを修正

## 次のステップ

1. **予算データファイルを特定**
   - ファイル名、場所を確認

2. **スクリプトに予算データファイルのパスを設定**
   - `convert_to_monthly_db_simple.py`を編集

3. **スクリプトを実行**
   - Plan列に予算データが入ることを確認

4. **結果を確認**
   - 2025年4月の511の予算データが正しく表示されているか確認

---

予算データファイルの場所が分かれば、スクリプトに追加して統合できます。予算データファイルのパスを教えていただければ、設定をお手伝いします。

