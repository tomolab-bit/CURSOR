# ファイル説明書

本ドキュメントは、会計コード比較・統合作業で作成した各ファイルの説明です。

---

## 📁 ディレクトリ構成

```
Manabox/20_DATA_Input/
├── 01.3consulting/          # マスターフォーマット作成関連
│   ├── Glory　Format_Source Data.csv        # ⭐ 元データ：#1と#2のAccount Code構造と予算金額
│   ├── Glory　Format - #3 sample(DB for BI report).csv  # 月次PL金額データ（#1実績）
│   ├── Glory　Format - Compara.csv          # （旧ファイル：Glory　Format_Source Data.csvと同じ）
│   ├── マスターフォーマット#3_最終版.csv      # 統合マスター（Account Code構造）
│   ├── 月次DB_SharePoint用.csv              # Looker Studio用DB（Plan/Actual形式）
│   ├── Looker_Studio_DB設計書.md              # Looker Studio設計書
│   ├── convert_to_monthly_db_simple.py      # 月次DB生成スクリプト
│   ├── create_master_final.py               # マスター生成スクリプト
│   └── その他のスクリプト（開発過程）
│
└── 02_Deep reserach/        # 比較分析関連
    ├── 会計コード比較表.md                   # 比較分析レポート
    ├── 会計コード比較表_旧バージョン.csv      # 旧バージョン（#1）
    └── 会計コード比較表_新バージョン.csv      # 新バージョン（#2）
```

---

## 🚀 クイックスタート

### 最初にすること

**`Glory　Format_Source Data.csv`**が#1と#2の元データです。このファイルには：
- #1（実績）と#2（予算）のAccount Code構造
- 予算金額（Đơn giá）

が含まれています。このファイルから#3（マスターフォーマット）を作成します。

### 基本的なワークフロー

#### フロー1: Account Code構造のマスター（#3）を作成

1. **元データを準備**: `Glory　Format_Source Data.csv`（#1と#2の構造と予算金額）
2. **スクリプトを実行**: `create_master_final.py`でマスターフォーマット#3を作成
3. **出力**: `マスターフォーマット#3_最終版.csv`が生成される

#### フロー2: 月次PLデータからLooker Studio用DBを作成

1. **元データを準備**: `Glory　Format - #3 sample(DB for BI report).csv`（月次PL金額データ）
2. **予算データを準備**（オプション）: 予算データも同じ#3形式のCSVファイル
3. **スクリプトを実行**: `convert_to_monthly_db_simple.py`で月次DBを作成
4. **SharePointにアップロード**: `月次DB_SharePoint用.csv`をアップロード
5. **Looker Studioで接続**: Type列でPlan/Actualをフィルタリング

---

## 📄 各ファイルの詳細説明

### 1. 元データファイル（01.3consulting/）

#### 📊 `Glory　Format_Source Data.csv` ⭐ **最優先：#1と#2の元データ**
**種別**: #1と#2のAccount Code構造と予算金額  
**用途**: #1（実績構造）と#2（予算構造）のAccount Code構造、および予算金額（Đơn giá）が含まれた元データファイル

**構造**:
- 左側（列0-8）: #1（実績）のAccount Code構造とメタ情報
- 右側（列10-19）: #2（予算）のAccount Code構造とメタ情報
- 列19: Đơn giá（予算金額）

**内容**:
- **Account Code**: 階層構造（レベル1-3）
- **Internal code**: 内部コード
- **Internal Account Name**: 内部アカウント名
- **KEIEI houkoku**: 経営報告書分類
- **詳細**: 日本語の詳細
- **Description**: 英語の説明
- **Chỉ tiêu**: ベトナム語の指標
- **Đơn giá**: 予算金額（#2のみ）

**特徴**:
- #1と#2の両方のAccount Code構造が含まれる
- 予算金額（Đơn giá）が含まれる
- **金額データは含まれない**（Account Code構造と予算金額のみ）
- このファイルから#3（マスターフォーマット）を作成する

**使用場面**: 
- **マスターフォーマット#3を作成する際の元データ**
- `create_master_final.py`で処理
- Account Code構造の統合マスターを作成

---

#### 📊 `Glory　Format - #3 sample(DB for BI report).csv`
**種別**: 月次PL金額データ（#1実績）  
**用途**: 実際の月次PLの金額データが含まれたファイル

**構造**:
- 行1-7: Account Codeの階層構造とメタ情報（Internal code、Account Name等）
- 行8: ヘッダー行（Date列と各Account Code列）
- 行9以降: 月次データ（Apr-25, May-25, Jun-25等）

**内容**:
- **Account Code**: 階層構造（レベル1-3）
- **月次金額データ**: 各Account Codeごとの月次実績金額
- **形式**: 横形式（Account Codeが列、月が行）

**特徴**:
- 実績データ（#1）のみが含まれる
- 予算データ（#2）は別ファイルまたは別月のデータとして管理
- このファイルから開始して、月次DBを作成する

**使用場面**: 
- **最初にアップロードする元データ**
- 月次DBを作成する際の入力ファイル
- `convert_to_monthly_db_simple.py`で処理

---

#### 📊 `Glory　Format - Compara.csv`（旧ファイル）
**種別**: Account Code構造の比較データ（旧ファイル）  
**用途**: `Glory　Format_Source Data.csv`と同じ内容の旧ファイル名

**注意**: 
- 現在は`Glory　Format_Source Data.csv`を使用してください
- このファイルは旧ファイル名の可能性があります

---

#### 🎯 `マスターフォーマット#3_最終版.csv`
**種別**: Account Code構造の統合マスター  
**用途**: #1と#2のAccount Code構造を統合したマスターフォーマット

**特徴**:
- Account Codeを基準に#1と#2を統合
- 階層構造（レベル0-3）を維持
- Account Codeがない行は親に紐づけて別行で管理
- Đơn giá（予算金額の参考値）を含む
- **金額データは含まれない**（Account Code構造のみ）

**データ統計**:
- マスター項目数: 128件
- サブアイテム数: 41件
- #1と#2の両方: 118件
- #1のみ: 6件
- #2のみ: 4件

**列構成**:
1. Account Code アカウント（階層構造）
2. Internal code
3. Internal Account Name
4. KEIEI houkoku
5. 詳細（日本語）
6. Description（英語）
7. Chỉ tiêu（ベトナム語）
8. Đơn giá（予算金額の参考値）
9. Source（Both/#1/#2）
10. Level（階層レベル）
11. Has Data #1（実績データ有無）
12. Has Data #2（予算データ有無）

**使用場面**:
- Account Code構造のマスターとして使用
- 月次DBと結合してLooker Studioで使用
- 会計システムのマスターとして使用

---

#### 📊 `月次DB_SharePoint用.csv` ⭐ **Looker Studio用DB**
**種別**: 月次データベース（Plan/Actual形式）  
**用途**: Looker Studioで使用する月次PLデータベース

**特徴**:
- 月毎に縦に並ぶ形式（ロング形式）
- Type列（Plan/Actual）で予算と実績を区別
- Amount列に金額を集約
- SharePointにアップロードして使用

**列構成**:
1. Year_Month（年月）
2. Date（日付）
3. Account_Code（会計コード）
4. Level（階層レベル）
5. Internal_code
6. Internal_Account_Name
7. KEIEI_houkoku
8. 詳細（日本語）
9. Description（英語）
10. **Type**（Plan/Actual）
11. **Amount**（金額）

**データ統計**（現在）:
- 総レコード数: 744件（372件 × 2）
- 年月数: 3ヶ月（Apr-25, May-25, Jun-25）
- Account Code数: 124件
- Plan行: 372件（現在は0）
- Actual行: 372件（実績データ）

**使用場面**:
- **SharePointにアップロードしてLooker Studioで使用**
- 実績と予算の比較分析
- 月次レポートの作成

**注意事項**:
- 現在Plan列は0（予算データ未統合）
- 予算データファイルを指定すると、Plan列に予算値が入る

---

#### 📖 `Looker_Studio_DB設計書.md`
**種別**: 設計ドキュメント  
**用途**: Looker Studioでデータを可視化するための設計書

**内容**:
- データ構造の説明
- Looker Studioでの接続方法
- 可視化の推奨構成（チャート例）
- フィルタ設定方法
- データ更新フロー
- トラブルシューティング

**使用場面**:
- Looker Studioでダッシュボードを作成する際の参考
- データの構造を理解したい時
- トラブルが発生した時の確認

---

#### 💻 `create_master_final.py`
**種別**: Pythonスクリプト  
**用途**: `Glory　Format_Source Data.csv`から`マスターフォーマット#3_最終版.csv`を生成

**機能**:
- #1と#2のデータを解析
- Account Codeを基準に統合
- 階層構造を維持
- サブアイテムを処理
- Đơn giáを保持

**実行方法**:
```bash
cd /Users/sugenotomohiro/Desktop/CURSOR/Manabox/20_DATA_Input/01.3consulting
python3 create_master_final.py
```

**使用場面**:
- 元データが更新された時
- 新しいAccount Codeが追加された時
- マスターフォーマットを再生成したい時

---

### 2. 比較分析関連（02_Deep reserach/）

#### 📋 `会計コード比較表.md`
**種別**: 比較分析レポート  
**用途**: #1と#2の違いを分析したレポート

**内容**:
- 主な違いのサマリー
- 詳細比較表（各Account Code別）
- 追加・削除・変更された項目の一覧
- 詳細化された項目の説明

**構成**:
1. 概要
2. 主な違いのサマリー
3. 詳細比較表
   - 売上（511）
   - 直接労務費（622）
   - 製造間接費（627）
   - 売上原価（632）
   - 一般管理費（642）
   - 法人税（821）
4. 主な変更点まとめ

**使用場面**:
- #1と#2の違いを理解したい時
- 変更点を確認したい時
- 会計システムの更新計画を立てる時

---

#### 📊 `会計コード比較表_旧バージョン.csv`
**種別**: 旧バージョンデータ（#1実績）  
**用途**: 旧バージョンの会計コード一覧をCSV形式で提供

**特徴**:
- #1（実績）のデータのみ
- エクセルやスプレッドシートで開ける形式
- 全項目の詳細情報

**列構成**:
- Account Code, アカウント, Internal code, Internal Account Name, KEIEI houkoku, 詳細, Description, Chỉ tiêu

**使用場面**:
- エクセルで分析したい時
- 旧バージョンのデータを参照したい時
- データベースにインポートしたい時

---

#### 📊 `会計コード比較表_新バージョン.csv`
**種別**: 新バージョンデータ（#2予算）  
**用途**: 新バージョンの会計コード一覧をCSV形式で提供

**特徴**:
- #2（予算）のデータのみ
- Đơn giá（予算金額）列を含む
- エクセルやスプレッドシートで開ける形式

**列構成**:
- Account Code, アカウント, Internal code, Internal Account Name, KEIEI houkoku, 詳細, Description, Chỉ tiêu, Đơn giá

**主な違い（旧バージョンとの比較）**:
- Đơn giá列が追加
- 福利費用（64218）が大幅に詳細化（20項目以上）
- 外部用役費（62778, 64278）に具体的なサービス名と金額が追加
- 市場調査関連の収益・原価項目が追加

**使用場面**:
- エクセルで予算を分析したい時
- 新バージョンのデータを参照したい時
- 予算金額を確認したい時

---

## 🔄 ファイル間の関係と処理フロー

### フロー1：Account Code構造のマスター（#3）作成

```
┌─────────────────────────────────────────┐
│  Glory　Format_Source Data.csv          │
│  ⭐ 元データ：#1と#2の構造と予算金額      │
│  （最初に使用するファイル）              │
└──────────────┬──────────────────────────┘
               │
               │ create_master_final.py
               │ （マスター生成スクリプト）
               ▼
┌─────────────────────────────────────────┐
│  マスターフォーマット#3_最終版.csv       │
│  （Account Code構造の統合マスター）      │
│  （金額データは含まれない）              │
└─────────────────────────────────────────┘
```

### フロー2：月次PLデータからLooker Studio用DBまで

```
┌─────────────────────────────────────────────────────────┐
│  Glory　Format - #3 sample(DB for BI report).csv        │
│  月次PL金額（#1実績）                                    │
└──────────────┬──────────────────────────────────────────┘
               │
               │ convert_to_monthly_db_simple.py
               │ （月次DB生成スクリプト）
               │
               │ オプション：予算データファイルも指定可能
               │
               ▼
┌─────────────────────────────────────────────────────────┐
│  月次DB_SharePoint用.csv                                 │
│  （Plan/Actual形式、月毎に縦に並ぶ）                     │
└──────────────┬──────────────────────────────────────────┘
               │
               │ SharePointにアップロード
               │
               ▼
┌─────────────────────────────────────────────────────────┐
│  Looker Studio ダッシュボード                            │
│  （実績 vs 予算の可視化）                                 │
└─────────────────────────────────────────────────────────┘
```

┌─────────────────────────────────────────┐
│  会計コード比較表_旧バージョン.csv       │
│  （#1のみ）                              │
└─────────────────────────────────────────┘
               │
               │ 比較分析
               ▼
┌─────────────────────────────────────────┐
│  会計コード比較表.md                     │
│  （比較レポート）                        │
└─────────────────────────────────────────┘
               ▲
               │
┌─────────────────────────────────────────┐
│  会計コード比較表_新バージョン.csv       │
│  （#2のみ）                              │
└─────────────────────────────────────────┘
```

---

## 📌 使用シーン別ガイド

### シーン1: Account Code構造のマスター（#3）を作成したい ⭐ **最初のステップ**

**開始ファイル**: `Glory　Format_Source Data.csv`（#1と#2の元データ）

1. **元データを準備**
   - `Glory　Format_Source Data.csv`を用意

2. **スクリプトを実行**
   ```bash
   cd /Users/sugenotomohiro/Desktop/CURSOR/Manabox/20_DATA_Input/01.3consulting
   python3 create_master_final.py
   ```

3. **出力ファイルを確認**
   - `マスターフォーマット#3_最終版.csv`が生成される
   - Account Code構造が統合されていることを確認

### シーン2: 月次PLデータからLooker Studio用DBを作成したい ⭐ **メインフロー**

**開始ファイル**: `Glory　Format - #3 sample(DB for BI report).csv`（月次PL金額データ）

1. **元データを準備**
   - `Glory　Format - #3 sample(DB for BI report).csv`を用意
   - 予算データがある場合は、別途予算データファイルも用意

2. **スクリプトを実行**
   ```bash
   cd /Users/sugenotomohiro/Desktop/CURSOR/Manabox/20_DATA_Input/01.3consulting
   python3 convert_to_monthly_db_simple.py
   ```
   - 予算データがある場合は、スクリプト内で`budget_file`のパスを指定

3. **出力ファイルを確認**
   - `月次DB_SharePoint用.csv`が生成される
   - Plan列とActual列が含まれていることを確認

4. **SharePointにアップロード**
   - エクセル形式に変換してスタイルを適用
   - SharePointにアップロード

5. **Looker Studioで接続**
   - SharePointのファイルをLooker Studioで接続
   - Type列でPlan/Actualをフィルタリング
   - ダッシュボードを作成

### シーン3: 新しい月のデータを追加したい

1. 新しい月のデータを`Glory　Format - #3 sample(DB for BI report).csv`に追加
2. `convert_to_monthly_db_simple.py`を実行
3. 既存の`月次DB_SharePoint用.csv`に追加するか、新しいファイルを作成
4. SharePointにアップロード

### シーン4: #1と#2の違いを理解したい

1. `会計コード比較表.md`を読む
2. 必要に応じて`会計コード比較表_旧バージョン.csv`と`会計コード比較表_新バージョン.csv`をエクセルで比較

### シーン5: エクセルで分析したい

1. `会計コード比較表_旧バージョン.csv`または`会計コード比較表_新バージョン.csv`をエクセルで開く
2. または`マスターフォーマット#3_最終版.csv`をエクセルで開く

---

## ⚠️ 重要な注意事項

### ファイルの優先順位と役割

1. **最優先：#1と#2の元データ**: `Glory　Format_Source Data.csv`
   - **最初に使用するファイル**
   - #1（実績）と#2（予算）のAccount Code構造と予算金額
   - このファイルから#3（マスターフォーマット）を作成する

2. **月次PL金額データ**: `Glory　Format - #3 sample(DB for BI report).csv`
   - 実際の月次PL金額データ（#1実績）
   - このファイルから月次DBを作成する

3. **Looker Studio用DB**: `月次DB_SharePoint用.csv`
   - Looker Studioで使用するメインファイル
   - Plan/Actual形式で月毎に縦に並ぶ
   - SharePointにアップロードして使用

4. **Account Code構造マスター**: `マスターフォーマット#3_最終版.csv`
   - Account Code構造の統合マスター
   - 金額データは含まれない（構造のみ）
   - 参考として使用

5. **参照用**: `会計コード比較表.md`
   - 違いを理解するための参考資料

6. **開発用**: `create_master_final.py`と`convert_to_monthly_db_simple.py`
   - 月次DBを生成するスクリプト
   - 最も頻繁に使用するスクリプト

### データの整合性

- Account Codeは必ず階層構造を維持する
- 実績データのAccount Codeはマスターフォーマット#3と完全一致させる
- ファイル名や列名は変更しない（スクリプトが動作しなくなる可能性）

---

## 📝 更新履歴

- 2025-01-XX: 初版作成
  - マスターフォーマット#3作成
  - 比較分析レポート作成
  - Looker Studio設計書作成

- 2025-11-XX: 大幅更新
  - 元データファイル（`Glory　Format_Source Data.csv`）の説明を追加・修正
  - 月次DB（`月次DB_SharePoint用.csv`）の説明を追加
  - 処理フローを明確化（#3作成フローと月次DB作成フローを分離）
  - 使用シーン別ガイドを更新

---

## 🔗 関連ドキュメント

- `Looker_Studio_DB設計書.md`: Looker Studioでの使用方法
- `変換手順書.md`: #3形式から月次DBへの変換手順
- `予算データ統合手順.md`: 予算データの統合方法
- `月次DB作成ガイド.md`: 月次DBの詳細な作成ガイド
- `会計コード比較表.md`: 詳細な比較分析

---

## ❓ よくある質問

**Q: どのファイルから始めればいいですか？**  
A: **`Glory　Format_Source Data.csv`**から始めてください。これが#1と#2の元データ（Account Code構造と予算金額）です。このファイルから#3（マスターフォーマット）を作成します。

**Q: どのファイルをLooker Studioで使えばいいですか？**  
A: **`月次DB_SharePoint用.csv`**を使用してください。Plan/Actual形式で月毎に縦に並んでおり、Looker Studioで使いやすい形式です。

**Q: 予算データはどこに入れますか？**  
A: 予算データも同じ#3形式のCSVファイルとして用意し、`convert_to_monthly_db_simple.py`の`budget_file`パラメータに指定してください。または、エクセルで`月次DB_SharePoint用.csv`のPlan行のAmount列を手動で更新することもできます。

**Q: 新しい月のデータを追加するには？**  
A: `Glory　Format - #3 sample(DB for BI report).csv`に新しい月のデータを追加してから、`convert_to_monthly_db_simple.py`を実行してください。

**Q: エクセルで開けない時は？**  
A: 文字コードがUTF-8-BOMになっているので、エクセルで「データ」→「テキストファイル」からインポートしてください。

**Q: Plan列がすべて0になっています。どうすればいいですか？**  
A: 予算データファイルを`convert_to_monthly_db_simple.py`の`budget_file`パラメータに指定するか、エクセルで手動でPlan行のAmount列を更新してください。詳細は`予算データ統合手順.md`を参照してください。

---

この説明書は、各ファイルの用途と使い方を理解するためのガイドです。不明な点があれば、各ファイルのコメントや設計書を参照してください。

