# #3形式CSVから月次DBへの変換手順書

## ✅ 完了したこと

1. **CSVファイルの変換**: `Glory　Format - #3 sample(DB for BI report).csv` を月毎に縦に並ぶ形式に変換しました
2. **出力ファイル**: `月次DB_SharePoint用.csv` が作成されました（372件のレコード）

## 📊 変換結果

- **総レコード数**: 372件
- **年月数**: 3ヶ月（Apr-25, May-25, Jun-25）
- **Account Code数**: 124件
- **形式**: 月毎に縦に並ぶ形式（ロング形式）

## 📋 出力ファイルの構造

```
Year_Month | Date | Account_Code | Level | Internal_code | Internal_Account_Name | KEIEI_houkoku | 詳細 | Description | Amount
2025-04    | Apr-25 | 511 | 1 | ... | 売上 | ... | Sales | 2,880,129,396
2025-04    | Apr-25 | 5113 | 2 | ... | サービス提供の売上 | ... | Services sale | 2,880,129,396
2025-05    | May-25 | 511 | 1 | ... | 売上 | ... | Sales | 3,887,476,495
...
```

## 🚀 次のステップ

### 方法1: エクセルで開いて保存（簡単）

1. **CSVファイルをエクセルで開く**
   - `月次DB_SharePoint用.csv`をダブルクリック
   - またはエクセルから「ファイル」→「開く」で選択

2. **スタイルを適用（オプション）**
   - ヘッダー行を選択して背景色を設定（例：濃い青 #366092、文字色：白）
   - 数値列（Amount）を選択して数値フォーマットを設定（カンマ区切り）
   - 枠線を追加

3. **エクセル形式で保存**
   - 「ファイル」→「名前を付けて保存」
   - ファイル形式を「Excel ブック (*.xlsx)」に変更
   - ファイル名: `月次DB_SharePoint用.xlsx`

4. **SharePointにアップロード**
   - SharePointのドキュメントライブラリに移動
   - 「アップロード」をクリック
   - `月次DB_SharePoint用.xlsx`を選択

### 方法2: スクリプトで自動変換（推奨）

pandasとopenpyxlがインストールされている場合、自動でエクセル形式に変換できます：

```bash
# 必要なライブラリをインストール（初回のみ）
pip3 install pandas openpyxl

# エクセル形式に変換
python3 convert_to_monthly_db.py
```

## 📝 データの確認

### サンプルデータ

```
2025-04 | 511 | 売上 | Sales | 2,880,129,396
2025-04 | 5113 | サービス提供の売上 | Services sale | 2,880,129,396
2025-04 | 51131 | Sales of merchandise and finished goods | 2,152,287,696
2025-05 | 511 | 売上 | Sales | 3,887,476,495
2025-05 | 5113 | サービス提供の売上 | Services sale | 3,887,476,495
```

## 🔧 実績と予算の統合について

現在のデータは実績データのみです。予算データも統合する場合：

1. **予算データの準備**
   - 予算データも同じ#3形式のCSVファイルで提供
   - または別のエクセルファイル

2. **データの統合**
   - 実績データと予算データを結合
   - Account Codeと年月で結合
   - 差異（Variance）を計算

3. **スクリプトの拡張**
   - `create_monthly_db.py`を使用して統合可能

## 📤 SharePointへのアップロード

### 手動アップロード

1. SharePointのドキュメントライブラリにアクセス
2. 「アップロード」または「新規」→「ファイル」をクリック
3. `月次DB_SharePoint用.xlsx`を選択
4. アップロード

### 自動アップロード（Power Automate）

Power Automateで以下のフローを作成：
1. ファイルが作成されたら（ローカルフォルダ）
2. SharePointにファイルをアップロード

## 🔗 Looker Studioでの使用

1. **Looker Studioでデータソースを作成**
   - 「SharePoint」を選択
   - SharePointのファイルを選択
   - テーブルを選択

2. **データの可視化**
   - 年月でフィルタ
   - Account Codeでグループ化
   - 金額で集計

3. **実績と予算の比較**
   - 実績データと予算データを結合
   - 差異を計算
   - グラフで表示

## ⚠️ 注意事項

### データの整合性

- Account Codeはマスターフォーマット#3と一致している必要があります
- 年月の形式は「YYYY-MM」形式に統一されています

### 数値の形式

- Amount列は数値形式です
- エクセルで開く際は、カンマ区切りの数値フォーマットを適用してください

### データの更新

新しい月のデータが追加された場合：
1. 新しいCSVファイルを準備
2. `convert_to_monthly_db_simple.py`を実行
3. 既存のデータに追加
4. SharePointにアップロード

## 📞 サポート

問題が発生した場合：
1. エラーメッセージを確認
2. CSVファイルの構造を確認
3. スクリプトの出力を確認

---

## 📊 変換スクリプトの使い方

### 基本的な使い方

```bash
cd /Users/sugenotomohiro/Desktop/CURSOR/Manabox/20_DATA_Input/01.3consulting
python3 convert_to_monthly_db_simple.py
```

### 出力ファイル

- **CSV形式**: `月次DB_SharePoint用.csv`
- **エクセル形式**: `convert_to_monthly_db.py`を実行すると`月次DB_SharePoint用.xlsx`が作成されます（pandasが必要）

### カスタマイズ

ファイルパスを変更する場合、スクリプト内の以下の部分を編集：

```python
input_file = '/Users/sugenotomohiro/Desktop/CURSOR/Manabox/20_DATA_Input/01.3consulting/Glory　Format - #3 sample(DB for BI report).csv'
output_file = '/Users/sugenotomohiro/Desktop/CURSOR/Manabox/20_DATA_Input/01.3consulting/月次DB_SharePoint用.csv'
```

---

これで、#3形式のCSVから月毎に縦に並ぶ形式のDBを作成できました！次のステップに進んでください。

